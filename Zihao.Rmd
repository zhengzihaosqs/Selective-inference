---
title: "Zihao"
author: "Zihao Zheng"
date: "11/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(knockoff)
library(doMC)
library(shiny)
library(MASS)
```

```{r}
# FDP for first measure (model-X, linear)

p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.gaussian(X, mu, Sigma)
W = stat.lasso_coefdiff(X, X_k, y)
Threshold = knockoff.threshold(W, fdr)
discoveries = which(W > Threshold)
fdp = sum(1 - discoveries %in% nonzero)/length(discoveries)
fdp

```

```{r}
p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.gaussian(X, mu, Sigma)

X_n = scale(X)
```


```{r}
# FDP for third measure (model-X, linear)

p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.gaussian(X, mu, Sigma)
W = stat.lasso_lambdadiff(X, X_k, y)
Threshold = knockoff.threshold(W, fdr)
discoveries = which(W > Threshold)
fdp = sum(1 - discoveries %in% nonzero)/length(discoveries)
fdp

```


```{r}
# FDP for fourth measure (model-X, linear)
set.seed(123)
p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.gaussian(X, mu, Sigma)
W = stat.lasso_lambdasmax(X, X_k, y)
Threshold = knockoff.threshold(W, fdr)
W
Threshold

#discoveries = which(W > Threshold)
#fdp = sum(1 - discoveries %in% nonzero)/length(discoveries)
#fdp

```

```{r}
# FDP for fourth measure (model-X, linear)
set.seed(123)
p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.gaussian(X, mu, Sigma)
W = stat.lasso_lambdasmax(create.fixed(X)$X, X_k, y)
Threshold = knockoff.threshold(W, fdr)
W
Threshold

#discoveries = which(W > Threshold)
#fdp = sum(1 - discoveries %in% nonzero)/length(discoveries)
#fdp

```

```{r}
# FDP for first measure (fixed-X, linear)

p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.fixed(X)
W = stat.lasso_coefdiff(X, X_k, y)
Threshold = knockoff.threshold(W, fdr)
discoveries = which(W > Threshold)
fdp = sum(1 - discoveries %in% nonzero)/length(discoveries)
fdp
```

```{r}
p=100; n=300; k=30; fdr=0.1;
mu=rep(0,p); Sigma=toeplitz(0.3^(0:(p-1)))
X = mvrnorm(n,mu,Sigma)
nonzero = sample(p, k)
beta = 3.5 * (1:p %in% nonzero)
y = X %*% beta + rnorm(n)
X_k = create.fixed(X)
X_k_n = create.fixed(X_k$X)
```

